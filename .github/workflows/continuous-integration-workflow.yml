on: [push]

jobs:

  esmac_docs:
    name: docs.opensimcreator.com/esmac2025 Build+Deploy
    runs-on: ubuntu-22.04
    steps:
    - uses: actions/checkout@v4

    - name: Setup Python Virtual Environment
      run: cd $GITHUB_WORKSPACE/docs && python -m venv venv/ && pip install -r requirements.txt

    - name: Build Sphinx Documentation
      run: cd $GITHUB_WORKSPACE/docs && sphinx-build source/ build/

    - name: Deploy documentation to docs.opensimcreator.com/esmac2025
      env:
          OSC_ESMAC2025_SSH_KEY: ${{ secrets.OSC_ESMAC2025_SSH_KEY }}
      run: |
        echo "${OSC_ESMAC2025_SSH_KEY}" > esmac2025_key
        chmod 600 esmac2025_key
        rsync -avz -e "ssh -i esmac2025_key -o 'StrictHostKeyChecking no'" $GITHUB_WORKSPACE/docs/build/ esmac2025@docs.opensimcreator.com:/var/www/docs.opensimcreator.com/esmac2025
