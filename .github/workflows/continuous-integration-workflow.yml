on: [push]

jobs:
  windows:
    name: Build on Windows
    runs-on: windows-2019
    steps:
    - uses: actions/checkout@v2
      with:
        path: osc
    - name: run build_windows.bat
      run: |
        cd $env:GITHUB_WORKSPACE
        scripts\\build_windows.bat || exit /b
    - uses: actions/upload-artifact@v2
      with:
        name: osc_windows.exe
        path: osc-build/*win64.exe
        if-no-files-found: error
    - uses: actions/upload-artifact@v2
      with:
        name: osc_windows_pdb
        path: osc-build/RelWithDebInfo/*.pdb
        if-no-files-found: error

  ubuntu1604:
    name: Build on Ubuntu 16.04 (Xenial)
    runs-on: ubuntu-16.04
    steps:
    - uses: actions/checkout@v2
      with:
        path: osc
    - name: run build_ubuntu-xenial.sh
      run: |
        cd $GITHUB_WORKSPACE
        ./osc/scripts/build_ubuntu-xenial.sh
    - uses: actions/upload-artifact@v2
      with:
        name: osc_xenial.deb
        path: osc-build/*.deb
        if-no-files-found: error

  ubuntu2004:
    name: Build on Ubuntu 20.04
    runs-on: ubuntu-20.04
    steps:
    - uses: actions/checkout@v2
      with:
        path: osc
    - name: run build script
      run: |
        cd $GITHUB_WORKSPACE
        ./osc/scripts/build_debian-buster.sh
    - uses: actions/upload-artifact@v2
      with:
        name: osc_focal_installer.deb
        path: osc-build/*.deb
        if-no-files-found: error

  macCatalina:
    name: Build on Mac (catalina)
    runs-on: macos-10.15
    steps:
    - uses: actions/checkout@v2
    - name: run build script
      run: |
        cd $GITHUB_WORKSPACE
        ./scripts/build_mac-catalina.sh
    - uses: actions/upload-artifact@v2
      with:
        name: osc_catalina.dmg
        path: osc-build/*.dmg
        if-no-files-found: error
